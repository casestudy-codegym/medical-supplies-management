<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quản lý nhân viên</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #f8f9fa;
        }
        .main-content {
            margin-top: 20px;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        h2 {
            color: #293A58;
            font-weight: bold;
        }
        .table thead {
            background-color: #293A58;
            color: white;
        }
        .table-hover tbody tr:hover {
            background-color: #e2e6ea;
        }
        .pagination .page-link {
            color: #fff;
            background-color: #293A58;
            border: 1px solid #293A58;
        }
        .pagination .page-link:hover {
            background-color: #1e2c45;
            color: #fff;
        }
        .pagination .active .page-link {
            background-color: #1e2c45;
            border-color: #1e2c45;
            color: #fff;
        }
        .pagination .disabled .page-link {
            background-color: #e9ecef;
            color: #6c757d;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div th:insert="~{layout/header :: header}"></div>

<div class="main-content">
    <div class="container mt-4">
        <h2 class="mb-4 text-center">QUẢN LÝ NHÂN VIÊN</h2>

        <!-- Hiển thị thông báo thành công -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Hiển thị thông báo lỗi -->
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Tìm kiếm -->
        <div class="d-flex justify-content-between mb-3">
            <form class="d-flex" method="get" th:action="@{/employees}">
                <input type="text" name="keyword" class="form-control me-2" th:value="${keyword}"
                       placeholder="Tìm theo tên nhân viên..." style="width: 300px;">
                <button class="btn btn-primary" type="submit">Tìm</button>
            </form>
            <a th:href="@{/employees/create}" class="btn btn-success">+ Thêm nhân viên</a>
        </div>

        <!-- Bảng danh sách -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Mã NV</th>
                    <th>Họ tên</th>
                    <th>Ngày sinh</th>
                    <th>Giới tính</th>
                    <th>Địa chỉ</th>
                    <th>Điện thoại</th>
                    <th>Email</th>
                    <th>Chức vụ</th>
                    <th>Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="e, iterStat : ${employeePage.content}">
                    <td th:text="${iterStat.index + 1 + (employeePage.number * employeePage.size)}">1</td>
                    <td th:text="${e.employeeCode}">MNV001</td>
                    <td th:text="${e.userAccount.fullName}">Nguyễn Văn A</td>
                    <td th:text="${e.userAccount.dateOfBirth != null ? #temporals.format(e.userAccount.dateOfBirth, 'dd/MM/yyyy') : ''}">01/01/1990</td>
                    <td>
                        <span th:if="${e.userAccount.gender == T(com.medicalsuppliesmanagement.entity.UserAccount.Gender).NAM}">Nam</span>
                        <span th:if="${e.userAccount.gender == T(com.medicalsuppliesmanagement.entity.UserAccount.Gender).NU}">Nữ</span>
                        <span th:if="${e.userAccount.gender == null}">-</span>
                    </td>
                    <td th:text="${e.userAccount.address ?: '-'}">Hà Nội</td>
                    <td th:text="${e.userAccount.phone ?: '-'}">0123456789</td>
                    <td th:text="${e.userAccount.email ?: '-'}">email@example.com</td>
                    <td th:text="${e.position ?: '-'}">Quản lý</td>
                    <td>
                        <a th:href="@{'/employees/edit/' + ${e.employeeId}}" class="btn btn-sm btn-warning me-1">Sửa</a>
                        <a th:href="@{'/employees/delete/' + ${e.employeeId}}"
                           onclick="return confirm('Bạn có chắc chắn muốn xóa nhân viên này?')"
                           class="btn btn-sm btn-danger">Xóa</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(employeePage.content)}">
                    <td colspan="10" class="text-center text-muted py-4">
                        <i>Không có nhân viên nào</i>
                        <span th:if="${keyword != null and !keyword.isEmpty()}" th:text="' phù hợp với từ khóa: ' + ${keyword}"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Thông tin phân trang -->
        <div th:if="${employeePage.totalElements > 0}" class="d-flex justify-content-between align-items-center mb-3">
            <small class="text-muted">
                Hiển thị <span th:text="${employeePage.number * employeePage.size + 1}">1</span>
                đến <span th:text="${employeePage.number * employeePage.size + employeePage.numberOfElements}">5</span>
                trong tổng số <span th:text="${employeePage.totalElements}">20</span> nhân viên
            </small>
        </div>

        <!-- Phân trang -->
        <nav th:if="${employeePage.totalPages > 1}">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${employeePage.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/employees(page=${employeePage.number - 1}, keyword=${keyword})}"
                       th:classappend="${employeePage.first} ? 'disabled'">«</a>
                </li>

                <!-- Hiển thị trang đầu nếu cần -->
                <li th:if="${employeePage.number > 2}" class="page-item">
                    <a class="page-link" th:href="@{/employees(page=0, keyword=${keyword})}">1</a>
                </li>
                <li th:if="${employeePage.number > 3}" class="page-item disabled">
                    <span class="page-link">...</span>
                </li>

                <!-- Hiển thị các trang xung quanh trang hiện tại -->
                <li class="page-item"
                    th:each="i : ${#numbers.sequence(T(java.lang.Math).max(0, employeePage.number - 2),
                                                   T(java.lang.Math).min(employeePage.totalPages - 1, employeePage.number + 2))}"
                    th:classappend="${i == employeePage.number} ? 'active'">
                    <a class="page-link"
                       th:href="@{/employees(page=${i}, keyword=${keyword})}"
                       th:text="${i + 1}">1</a>
                </li>

                <!-- Hiển thị trang cuối nếu cần -->
                <li th:if="${employeePage.number < employeePage.totalPages - 4}" class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
                <li th:if="${employeePage.number < employeePage.totalPages - 3}" class="page-item">
                    <a class="page-link" th:href="@{/employees(page=${employeePage.totalPages - 1}, keyword=${keyword})}"
                       th:text="${employeePage.totalPages}">10</a>
                </li>

                <li class="page-item" th:classappend="${employeePage.last} ? 'disabled'">
                    <a class="page-link" th:href="@{/employees(page=${employeePage.number + 1}, keyword=${keyword})}"
                       th:classappend="${employeePage.last} ? 'disabled'">»</a>
                </li>
            </ul>
        </nav>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>