<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Quản lý khách hàng</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .navbar, .btn-primary {
            background-color: #293A58;
        }

        .navbar-brand, .nav-link, .btn-primary {
            color: #fff !important;
        }

        .table th {
            background-color: #293A58;
            color: white;
        }

        .pagination .page-link {
            color: #fff; /* ✅ Màu chữ trắng */
            background-color: #293A58; /* Thêm nền cho đồng bộ */
            border: 1px solid #293A58;
        }

        .pagination .page-link:hover {
            background-color: #1e2c45;
            color: #fff;
        }

        .pagination .active .page-link {
            background-color: #1e2c45;
            border-color: #1e2c45;
            color: #fff;
        }

        .pagination .disabled .page-link {
            background-color: #e9ecef;
            color: #6c757d;
            pointer-events: none;
        }
    </style>

</head>
<body>
<div th:replace="~{layout/header :: header}"></div>
<div class="container-fluid text-center my-4">
    <h2 class="fw-bold" style="color: #293A58;">QUẢN LÝ KHÁCH HÀNG</h2>
</div>


<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <form class="d-flex" method="get" th:action="@{/customers}">
            <input type="text" name="keyword" class="form-control me-2"
                   style="width: 400px;"
                   th:value="${keyword}" placeholder="Tìm theo tên...">
            <button class="btn btn-primary" type="submit">Tìm kiếm</button>
        </form>

        <a th:href="@{/customers/new}" class="btn btn-success">+ Thêm khách hàng</a>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead class="table-dark">
            <tr>
                <th>Mã KH</th>
                <th>Tên</th>
                <th>Loại</th>
                <th>Địa chỉ</th>
                <th>SĐT</th>
                <th>Email</th>
                <th>Xóa</th>
                <th>Sửa</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="customer : ${customers}">
                <td th:text="${customer.customerCode}"></td>
                <td th:text="${customer.name}"></td>
                <td th:text="${customer.type}"></td>
                <td th:text="${customer.address}"></td>
                <td th:text="${customer.phone}"></td>
                <td th:text="${customer.email}"></td>
                <td>
                    <button class="btn btn-sm btn-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteModal"
                            th:attr="data-id=${customer.customerId},data-name=${customer.name}">
                        <i class="bi bi-trash3"></i> Xóa
                    </button>
                </td>
                <td>
                    <a th:href="@{'/customers/edit/' + ${customer.customerId}}" class="btn btn-sm btn-warning">
                        <i class="bi bi-pencil-square"></i> Sửa
                    </a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(customers)}">
                <td colspan="8" class="text-center">Không tìm thấy khách hàng nào</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <nav th:if="${totalPages > 1}">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/customers(page=${currentPage - 1}, keyword=${keyword})}">«</a>
            </li>
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/customers(page=${i}, keyword=${keyword})}"
                   th:text="${i + 1}">1</a>
            </li>
            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/customers(page=${currentPage + 1}, keyword=${keyword})}">»</a>
            </li>
        </ul>
    </nav>
</div>

<!-- Modal Xác Nhận Xóa -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">Xác nhận xóa</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Đóng"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xóa khách hàng <strong id="customerName"></strong> không?</p>
            </div>
            <div class="modal-footer">
                <form id="deleteForm" method="post" action="#">
                    <!-- CSRF token cho Spring Security -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-danger">Xóa</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const deleteModal = document.getElementById('deleteModal');
    deleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const customerId = button.getAttribute('data-id');
        const customerName = button.getAttribute('data-name');

        // Gán tên vào modal
        deleteModal.querySelector('#customerName').textContent = customerName;

        // Gán action form
        const form = deleteModal.querySelector('#deleteForm');
        form.action = `/customers/delete/${customerId}`;
    });
</script>
</body>
</html>